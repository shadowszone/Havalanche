<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>WalletConnect Test</title>
  <script src="https://unpkg.com/@w3vm/react"></script>
</head>
<body>
  <button id="connectButton">Connect Wallet</button>

  <script>
    // Initialize W3VM
    const { W3, initW3, Injected, WalletConnect } = window["@w3vm/react"];

    // WalletConnect Project ID (replace this with your actual Project ID)
    const projectId = "80e0b203e3b4769d78f3d05e3337d0ae";  // Replace with your WalletConnect project ID

    // Setup W3 connectors (WalletConnect and Injected)
    const w3props = initW3({
      connectors: [
        new Injected({ icon: "path/to/icon.png" }), // Injected wallet (e.g., MetaMask)
        new WalletConnect({
          projectId, 
          icon: "path/to/walletconnect-icon.png",
          showQrModal: true,
          chains: [1, 137],  // Ethereum Mainnet and Polygon
        }),
      ],
      SSR: true,
    });

    // Set up the W3VM context
    const w3vm = new W3(w3props);

    // Show alert when connectors are initialized
    alert("W3VM Initialized! Connect a Wallet.");

    // Event listener for the "Connect Wallet" button
    document.getElementById("connectButton").addEventListener("click", async () => {
      try {
        alert("Attempting to connect to the wallet...");

        // Check if WalletConnect is available
        const walletConnect = w3vm.connectors.find(conn => conn instanceof WalletConnect);

        if (walletConnect) {
          alert("WalletConnect found, attempting to connect...");

          await walletConnect.connect();

          // On success, show an alert with the wallet address
          alert("Wallet Connected!");
          alert("Connected address: " + walletConnect.getAddress());
        } else {
          alert("WalletConnect not found!");
        }
      } catch (err) {
        // On failure, show an error alert
        alert("Failed to connect wallet: " + err.message);
      }
    });
  </script>
</body>
</html>
